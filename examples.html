<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Examples - brokenrecord.studio</title>
        <meta
            name="description"
            content="Code examples and demonstrations for brokenrecord.studio - Physics as Code Programming Language"
        />

        <!-- Marked.js for markdown parsing -->
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

        <!-- Prism.js for syntax highlighting -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
            rel="stylesheet"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-elixir.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>

        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                --bg-dark: #0a0a0f;
                --bg-gradient-start: #1a0f2e;
                --bg-gradient-end: #0f1a2e;
                --accent-purple: #a855f7;
                --accent-cyan: #06b6d4;
                --accent-pink: #ec4899;
                --text-primary: #f8fafc;
                --text-secondary: #cbd5e1;
                --code-bg: #1e293b;
                --success: #10b981;
                --error: #ef4444;
                --card-bg: rgba(30, 41, 59, 0.5);
                --border-color: rgba(168, 85, 247, 0.2);
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
                    "Oxygen", "Ubuntu", "Cantarell", sans-serif;
                background: linear-gradient(
                    135deg,
                    var(--bg-gradient-start) 0%,
                    var(--bg-gradient-end) 100%
                );
                color: var(--text-primary);
                line-height: 1.6;
                overflow-x: hidden;
            }

            /* Animated background particles */
            .particles {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 0;
            }

            .particle {
                position: absolute;
                width: 4px;
                height: 4px;
                background: var(--accent-cyan);
                border-radius: 50%;
                opacity: 0.3;
                animation: float 20s infinite;
            }

            @keyframes float {
                0%,
                100% {
                    transform: translate(0, 0) rotate(0deg);
                }
                33% {
                    transform: translate(30px, -30px) rotate(120deg);
                }
                66% {
                    transform: translate(-30px, 30px) rotate(240deg);
                }
            }

            /* Container */
            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 2rem;
                position: relative;
                z-index: 1;
            }

            /* Navigation */
            nav {
                padding: 2rem 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .logo {
                font-size: 1.5rem;
                font-weight: 700;
                background: linear-gradient(
                    135deg,
                    var(--accent-purple),
                    var(--accent-cyan)
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .nav-links {
                display: flex;
                gap: 2rem;
                list-style: none;
            }

            .nav-links a {
                color: var(--text-secondary);
                text-decoration: none;
                transition: color 0.3s;
                font-size: 0.95rem;
            }

            .nav-links a:hover {
                color: var(--accent-cyan);
            }

            .nav-links a.active {
                color: var(--accent-cyan);
            }

            /* Hero Section */
            .hero {
                padding: 4rem 0;
                text-align: center;
            }

            .hero h1 {
                font-size: 3.5rem;
                font-weight: 900;
                margin-bottom: 1.5rem;
                line-height: 1.1;
            }

            .hero h1 .gradient-text {
                background: linear-gradient(
                    135deg,
                    var(--accent-purple),
                    var(--accent-cyan),
                    var(--accent-pink)
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                background-size: 200% 200%;
                animation: gradient-shift 3s ease infinite;
            }

            @keyframes gradient-shift {
                0%,
                100% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
            }

            .hero p {
                font-size: 1.25rem;
                color: var(--text-secondary);
                margin-bottom: 2rem;
                max-width: 800px;
                margin-left: auto;
                margin-right: auto;
            }

            /* Search Bar */
            .search-container {
                max-width: 600px;
                margin: 0 auto 3rem;
                position: relative;
            }

            .search-input {
                width: 100%;
                padding: 1rem 3rem 1rem 1.5rem;
                border: 2px solid var(--border-color);
                border-radius: 50px;
                font-size: 1rem;
                transition: all 0.3s;
                background: var(--card-bg);
                color: var(--text-primary);
            }

            .search-input:focus {
                outline: none;
                border-color: var(--accent-cyan);
                box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
            }

            .search-icon {
                position: absolute;
                right: 1.5rem;
                top: 50%;
                transform: translateY(-50%);
                color: var(--text-secondary);
            }

            /* Examples Grid */
            .examples-container {
                display: grid;
                grid-template-columns: 250px 1fr;
                gap: 2rem;
                margin-bottom: 4rem;
            }

            /* Sidebar */
            .sidebar {
                background: var(--card-bg);
                border: 1px solid var(--border-color);
                border-radius: 16px;
                padding: 1.5rem;
                height: fit-content;
                position: sticky;
                top: 120px;
                backdrop-filter: blur(12px);
            }

            .sidebar h3 {
                font-size: 1rem;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin-bottom: 1rem;
                color: var(--text-primary);
            }

            .example-list {
                list-style: none;
            }

            .example-item {
                margin-bottom: 0.5rem;
            }

            .example-link {
                display: block;
                padding: 0.75rem 1rem;
                color: var(--text-secondary);
                text-decoration: none;
                border-radius: 8px;
                transition: all 0.2s;
                font-size: 0.9rem;
            }

            .example-link:hover {
                background: rgba(6, 182, 212, 0.1);
                color: var(--accent-cyan);
                transform: translateX(5px);
            }

            .example-link.active {
                background: rgba(6, 182, 212, 0.2);
                color: var(--accent-cyan);
                font-weight: 600;
                box-shadow: 0 2px 8px rgba(6, 182, 212, 0.1);
            }

            /* Content Area */
            .content {
                background: var(--card-bg);
                border: 1px solid var(--border-color);
                border-radius: 16px;
                padding: 2.5rem;
                backdrop-filter: blur(12px);
            }

            .content h1 {
                font-size: 2.5rem;
                font-weight: 800;
                margin-bottom: 1rem;
                color: var(--text-primary);
            }

            .content h2 {
                font-size: 1.8rem;
                font-weight: 700;
                margin-top: 2rem;
                margin-bottom: 1rem;
                color: var(--text-primary);
            }

            .content h3 {
                font-size: 1.4rem;
                font-weight: 600;
                margin-top: 1.5rem;
                margin-bottom: 0.75rem;
                color: var(--text-primary);
            }

            .content p {
                margin-bottom: 1rem;
                color: var(--text-secondary);
                line-height: 1.7;
            }

            .content ul,
            .content ol {
                margin-bottom: 1rem;
                padding-left: 2rem;
            }

            .content li {
                margin-bottom: 0.5rem;
                color: var(--text-secondary);
            }

            .content code {
                background: var(--code-bg);
                padding: 0.2rem 0.4rem;
                border-radius: 4px;
                font-family: "Monaco", "Courier New", monospace;
                font-size: 0.9rem;
                color: var(--accent-cyan);
            }

            .content pre {
                background: var(--code-bg);
                color: var(--text-primary);
                padding: 1.5rem;
                border-radius: 8px;
                overflow-x: auto;
                margin-bottom: 1rem;
                border: 1px solid var(--border-color);
            }

            .content pre code {
                background: none;
                color: inherit;
                padding: 0;
            }

            .content blockquote {
                border-left: 4px solid var(--accent-purple);
                padding-left: 1rem;
                margin: 1rem 0;
                color: var(--text-secondary);
                font-style: italic;
            }

            .content table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 1rem;
            }

            .content th,
            .content td {
                padding: 0.75rem;
                text-align: left;
                border-bottom: 1px solid var(--border-color);
            }

            .content th {
                font-weight: 600;
                color: var(--text-primary);
                background: var(--card-bg);
            }

            /* Prism.js syntax highlighting overrides */
            .content pre[class*="language-"] {
                background: var(--code-bg);
                margin: 1rem 0;
                padding: 1rem;
                border-radius: 8px;
                overflow: auto;
                border: 1px solid var(--border-color);
            }

            .content code[class*="language-"] {
                background: none;
                color: inherit;
                padding: 0;
                font-family: "Monaco", "Courier New", monospace;
                font-size: 0.9rem;
            }

            /* Better table styling */
            .content table {
                border-collapse: collapse;
                width: 100%;
                margin: 1.5rem 0;
                border-radius: 8px;
                overflow: hidden;
                border: 1px solid var(--border-color);
            }

            .content th,
            .content td {
                padding: 0.75rem 1rem;
                text-align: left;
                border-bottom: 1px solid var(--border-color);
            }

            .content th {
                background: var(--card-bg);
                font-weight: 600;
                color: var(--text-primary);
            }

            .content tr:last-child td {
                border-bottom: none;
            }

            .content tr:hover {
                background: rgba(6, 182, 212, 0.05);
            }

            /* Example description styling */
            .example-description {
                background: rgba(168, 85, 247, 0.1);
                border-left: 4px solid var(--accent-purple);
                padding: 1rem 1.5rem;
                margin: 1.5rem 0;
                border-radius: 0 8px 8px 0;
            }

            .example-description h4 {
                color: var(--accent-purple);
                margin-bottom: 0.5rem;
                font-size: 1.1rem;
            }

            .example-description p {
                margin-bottom: 0;
                color: var(--text-secondary);
            }

            /* Footer */
            footer {
                background: var(--bg-dark);
                color: var(--text-secondary);
                padding: 60px 0 40px;
                margin-top: 4rem;
            }

            .footer-content {
                text-align: center;
                margin-bottom: 2rem;
            }

            .footer-content h3 {
                font-size: 1.75rem;
                font-weight: 900;
                background: linear-gradient(
                    135deg,
                    var(--accent-purple),
                    var(--accent-cyan)
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-bottom: 1rem;
            }

            .footer-content p {
                color: var(--text-secondary);
                line-height: 1.7;
            }

            .footer-bottom {
                border-top: 1px solid var(--border-color);
                padding-top: 2rem;
                text-align: center;
                color: var(--text-secondary);
                font-size: 0.9rem;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .hero h1 {
                    font-size: 2.5rem;
                }

                .examples-container {
                    grid-template-columns: 1fr;
                }

                .sidebar {
                    position: static;
                }

                .nav-links {
                    display: none;
                }
            }

            /* Loading state */
            .loading {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 200px;
                color: var(--text-secondary);
            }

            /* Error state */
            .error {
                background: rgba(239, 68, 68, 0.1);
                border: 1px solid rgba(239, 68, 68, 0.3);
                color: var(--error);
                padding: 1rem;
                border-radius: 8px;
                margin-bottom: 1rem;
            }
        </style>
    </head>
    <body>
        <!-- Animated particles background -->
        <div class="particles" id="particles"></div>

        <div class="container">
            <!-- Navigation -->
            <nav>
                <div class="logo">üéµ brokenrecord.studio</div>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html#features">Features</a></li>
                    <li><a href="documentation.html">Docs</a></li>
                    <li><a href="examples.html" class="active">Examples</a></li>
                    <li><a href="open-source.html">Source</a></li>
                    <li>
                        <a
                            href="https://github.com/c-u-l8er/brokenrecord.studio"
                            >GitHub</a
                        >
                    </li>
                </ul>
            </nav>

            <!-- Hero Section -->
            <section class="hero">
                <h1>
                    <span class="gradient-text">AII Code Examples</span>
                </h1>
                <p>
                    Explore practical examples and demonstrations of the AII
                    (Artificial Interaction Intelligence) system -
                    Particle-based Physics-grounded Programming with
                    Conservation Types
                </p>

                <!-- Search Bar -->
                <div class="search-container">
                    <input
                        type="text"
                        id="searchInput"
                        class="search-input"
                        placeholder="Search examples..."
                    />
                    <div class="search-icon">üîç</div>
                </div>
            </section>

            <!-- Examples Content -->
            <section class="examples-container">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <h3>Examples</h3>
                    <ul class="example-list" id="exampleList">
                        <!-- Examples will be loaded here -->
                    </ul>
                </aside>

                <!-- Content Area -->
                <main class="content" id="contentArea">
                    <div class="loading">Loading examples...</div>
                </main>
            </section>
        </div>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="footer-content">
                    <h3>üéµ brokenrecord.studio</h3>
                    <p>
                        Physics-based programming language where conservation
                        laws are enforced through type constraints.
                    </p>
                </div>
                <div class="footer-bottom">
                    <p>
                        &copy;
                        <span id="current-year"></span> brokenrecord.studio -
                        Conservation laws as code.
                    </p>
                </div>
            </div>
        </footer>

        <script>
            // Generate animated particles
            const particlesContainer = document.getElementById("particles");
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement("div");
                particle.className = "particle";
                particle.style.left = Math.random() * 100 + "%";
                particle.style.top = Math.random() * 100 + "%";
                particle.style.animationDelay = Math.random() * 20 + "s";
                particle.style.animationDuration =
                    15 + Math.random() * 10 + "s";
                particlesContainer.appendChild(particle);
            }

            // Set dynamic copyright year
            document.getElementById("current-year").textContent =
                new Date().getFullYear();

            // Examples data
            let examples = [
                "aii_particle_physics.ex",
                "aii_chemical_reactions.ex",
                "aii_hardware_dispatch.ex",
                "aii_conservation_verification.ex",
            ];
            let currentExample = null;
            let allExamplesContent = {};

            // Example descriptions
            const exampleDescriptions = {
                "aii_particle_physics.ex": {
                    title: "AII Particle Physics",
                    description:
                        "Demonstrates basic AII particle physics with conservation types, property vs state distinction, and hardware acceleration hints. Shows compile-time conservation verification and Zig runtime integration.",
                    features: [
                        "Conservation types",
                        "Hardware acceleration",
                        "Property vs state",
                        "Compile-time verification",
                        "Zig runtime",
                    ],
                },
                "aii_chemical_reactions.ex": {
                    title: "AII Chemical Reactions",
                    description:
                        "Chemical reaction networks with conservation enforcement. Demonstrates molecular interactions, bonding, conservation of mass/charge/energy, reaction kinetics, and neural network prediction on NPU.",
                    features: [
                        "Molecular interactions",
                        "Mass conservation",
                        "Reaction kinetics",
                        "NPU acceleration",
                        "Catalyst interactions",
                    ],
                },
                "aii_hardware_dispatch.ex": {
                    title: "AII Hardware Dispatch",
                    description:
                        "Demonstrates heterogeneous hardware acceleration with RT Cores for spatial queries, Tensor Cores for N-body forces, NPU for learned dynamics, and automatic hardware dispatch based on interaction type.",
                    features: [
                        "RT Cores acceleration",
                        "Tensor Cores",
                        "NPU acceleration",
                        "Auto hardware dispatch",
                        "Fallback chains",
                    ],
                },
                "aii_conservation_verification.ex": {
                    title: "AII Conservation Verification",
                    description:
                        "Demonstrates conservation law enforcement and violation detection with compile-time checking, runtime verification, violation detection and reporting, and conservation restoration mechanisms.",
                    features: [
                        "Conservation enforcement",
                        "Violation detection",
                        "Runtime verification",
                        "Debugging tools",
                        "Restoration mechanisms",
                    ],
                },
            };

            // Initialize examples
            async function initExamples() {
                try {
                    console.log("Initializing examples...");

                    // Initialize marked.js
                    if (!initializeMarked()) {
                        console.warn(
                            "Marked.js initialization failed, continuing with basic functionality",
                        );
                    }

                    await loadAllExamples();
                    console.log(
                        "Examples loaded:",
                        Object.keys(allExamplesContent),
                    );
                    renderExampleList();

                    // Load first example by default or check URL hash
                    const hash = window.location.hash.substring(1);
                    if (hash && examples.includes(hash)) {
                        loadExample(hash);
                    } else if (examples.length > 0) {
                        loadExample(examples[0]);
                    }
                } catch (error) {
                    console.error("Error initializing examples:", error);
                    showError(
                        `Failed to initialize examples: ${error.message}`,
                    );
                }
            }

            // Load all examples
            async function loadAllExamples() {
                console.log(`Starting to load ${examples.length} examples...`);
                let loadedCount = 0;
                let failedCount = 0;

                for (const example of examples) {
                    try {
                        console.log(`Loading example: ${example}`);
                        const response = await fetch(`lib/examples/${example}`, { cache: 'no-cache' });
                        if (response.ok) {
                            const content = await response.text();
                            allExamplesContent[example] = content;
                            loadedCount++;
                            console.log(
                                `Successfully loaded ${example} (${content.length} characters)`,
                            );
                        } else {
                            failedCount++;
                            console.error(
                                `Failed to load ${example}: ${response.status} ${response.statusText}`,
                            );
                        }
                    } catch (error) {
                        failedCount++;
                        console.error(`Error loading ${example}:`, error);
                    }
                }

                console.log(
                    `Example loading complete. Success: ${loadedCount}, Failed: ${failedCount}`,
                );

                if (loadedCount === 0) {
                    throw new Error("No examples could be loaded");
                }
            }

            // Render example list in sidebar
            function renderExampleList() {
                const exampleList = document.getElementById("exampleList");
                exampleList.innerHTML = "";

                examples.forEach((example) => {
                    const li = document.createElement("li");
                    li.className = "example-item";

                    const a = document.createElement("a");
                    a.href = `#${example}`;
                    a.className = "example-link";
                    a.textContent = formatExampleTitle(example);
                    a.addEventListener("click", (e) => {
                        e.preventDefault();
                        loadExample(example);
                        window.location.hash = example;
                    });

                    li.appendChild(a);
                    exampleList.appendChild(li);
                });
            }

            // Format example title
            function formatExampleTitle(filename) {
                const desc = exampleDescriptions[filename];
                return desc
                    ? desc.title
                    : filename
                          .replace(".ex", "")
                          .replace(/_/g, " ")
                          .replace(/\b\w/g, (l) => l.toUpperCase());
            }

            // Load and display example
            async function loadExample(exampleName) {
                try {
                    console.log(`Loading example: ${exampleName}`);

                    if (!allExamplesContent[exampleName]) {
                        showError(
                            `Example ${exampleName} not found or could not be loaded.`,
                        );
                        return;
                    }

                    currentExample = exampleName;

                    // Update active state in sidebar
                    document
                        .querySelectorAll(".example-link")
                        .forEach((link) => {
                            link.classList.remove("active");
                            if (
                                link.getAttribute("href") === `#${exampleName}`
                            ) {
                                link.classList.add("active");
                            }
                        });

                    // Check if marked is available
                    if (typeof marked === "undefined") {
                        showError("Markdown parser (marked.js) not loaded.");
                        return;
                    }

                    // Get example description
                    const desc = exampleDescriptions[exampleName];

                    // Build content with description and code
                    let content = "";

                    if (desc) {
                        content += `<div class="example-description">`;
                        content += `<h4>${desc.title}</h4>`;
                        content += `<p>${desc.description}</p>`;
                        if (desc.features && desc.features.length > 0) {
                            content += `<p><strong>Key features:</strong> ${desc.features.join(", ")}</p>`;
                        }
                        content += `</div>`;
                    }

                    // Add the code
                    const codeContent = allExamplesContent[exampleName];
                    content += `<pre><code class="language-elixir">${escapeHtml(codeContent)}</code></pre>`;

                    // Add run button and console output area
                    content += `
                    <div style="margin-top: 2rem;">
                        <button id="runExampleBtn" class="run-button" style="
                            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
                            color: white;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            font-size: 1rem;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s;
                            margin-bottom: 1rem;
                        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            üöÄ Run Example
                        </button>

                        <div id="consoleOutput" style="
                            background: var(--code-bg);
                            border: 1px solid var(--border-color);
                            border-radius: 8px;
                            padding: 1rem;
                            margin-top: 1rem;
                            font-family: 'Monaco', 'Courier New', monospace;
                            font-size: 0.9rem;
                            color: var(--text-primary);
                            max-height: 400px;
                            overflow-y: auto;
                            display: block;
                        ">
                            <div id="consoleContent" style="white-space: pre-wrap;">Click "üöÄ Run Example" to see console output and execution logs...</div>
                        </div>
                    </div>
                `;

                    document.getElementById("contentArea").innerHTML = content;

                    // Add event listener to run button
                    const runBtn = document.getElementById("runExampleBtn");
                    if (runBtn) {
                        runBtn.addEventListener("click", () =>
                            runExample(exampleName),
                        );
                    }

                    // Re-run Prism.js highlighting for the newly added content
                    if (typeof Prism !== "undefined") {
                        Prism.highlightAll();
                    } else {
                        console.warn(
                            "Prism.js not loaded, syntax highlighting disabled.",
                        );
                    }
                } catch (error) {
                    console.error(
                        `Error loading example ${exampleName}:`,
                        error,
                    );
                    showError(`Failed to load example: ${error.message}`);
                }
            }

            // Initialize marked.js when available
            function initializeMarked() {
                if (typeof marked === "undefined") {
                    console.error("Marked.js not loaded");
                    return false;
                }

                try {
                    // Configure marked options with simpler approach
                    marked.setOptions({
                        highlight: function (code, lang) {
                            // Ensure code is a string
                            const codeStr =
                                typeof code === "string"
                                    ? code
                                    : String(code || "");
                            const language = lang || "plaintext";

                            if (Prism.languages[language]) {
                                try {
                                    console.log(
                                        "Highlighting code for language:",
                                        language,
                                    );
                                    console.log("Code type:", typeof codeStr);
                                    console.log(
                                        "Prism.languages[language] type:",
                                        typeof Prism.languages[language],
                                    );

                                    const highlighted = Prism.highlight(
                                        codeStr,
                                        Prism.languages[language],
                                        language,
                                    );
                                    console.log(
                                        "Highlighted type:",
                                        typeof highlighted,
                                    );
                                    console.log(
                                        "Highlighted value:",
                                        highlighted,
                                    );

                                    // Ensure highlighted is a string
                                    const result =
                                        typeof highlighted === "string"
                                            ? highlighted
                                            : String(highlighted || codeStr);
                                    console.log("Result type:", typeof result);
                                    return result;
                                } catch (error) {
                                    console.error(
                                        "Error highlighting code:",
                                        error,
                                    );
                                    return escapeHtml(codeStr);
                                }
                            }
                            return escapeHtml(codeStr);
                        },
                        langPrefix: "language-",
                        breaks: true,
                        gfm: true,
                    });

                    console.log("Marked.js initialized successfully");
                    return true;
                } catch (error) {
                    console.error("Error initializing marked.js:", error);
                    return false;
                }
            }

            // Escape HTML to prevent XSS
            function escapeHtml(text) {
                const div = document.createElement("div");
                div.textContent = text;
                return div.innerHTML;
            }

            // Show error message
            function showError(message) {
                document.getElementById("contentArea").innerHTML = `
                <div class="error">
                    <strong>Error:</strong> ${message}
                </div>
            `;
            }

            // Search functionality
            document
                .getElementById("searchInput")
                .addEventListener("input", function (e) {
                    const searchTerm = e.target.value.toLowerCase();

                    if (!searchTerm) {
                        renderExampleList();
                        return;
                    }

                    const exampleList = document.getElementById("exampleList");
                    exampleList.innerHTML = "";

                    examples.forEach((example) => {
                        const title = formatExampleTitle(example).toLowerCase();
                        const content = allExamplesContent[example]
                            ? allExamplesContent[example].toLowerCase()
                            : "";
                        const desc = exampleDescriptions[example];
                        const description = desc
                            ? desc.description.toLowerCase()
                            : "";

                        if (
                            title.includes(searchTerm) ||
                            content.includes(searchTerm) ||
                            description.includes(searchTerm)
                        ) {
                            const li = document.createElement("li");
                            li.className = "example-item";

                            const a = document.createElement("a");
                            a.href = `#${example}`;
                            a.className = "example-link";
                            a.textContent = formatExampleTitle(example);
                            a.addEventListener("click", (e) => {
                                e.preventDefault();
                                loadExample(example);
                                window.location.hash = example;
                            });

                            li.appendChild(a);
                            exampleList.appendChild(li);
                        }
                    });

                    if (exampleList.innerHTML === "") {
                        exampleList.innerHTML =
                            '<li class="example-item"><div class="example-link">No examples found</div></li>';
                    }
                });

            // Handle hash change
            window.addEventListener("hashchange", function () {
                const hash = window.location.hash.substring(1);
                if (hash && examples.includes(hash)) {
                    loadExample(hash);
                }
            });

            // Initialize on DOM content loaded
            document.addEventListener("DOMContentLoaded", function () {
                console.log("DOM Content Loaded");

                // Check if external libraries are loaded
                console.log(
                    "Marked.js available:",
                    typeof marked !== "undefined",
                );
                console.log(
                    "Prism.js available:",
                    typeof Prism !== "undefined",
                );

                // Wait a bit for external libraries to load
                setTimeout(() => {
                    console.log("Initializing examples after timeout...");
                    console.log(
                        "Marked.js available after timeout:",
                        typeof marked !== "undefined",
                    );
                    console.log(
                        "Prism.js available after timeout:",
                        typeof Prism !== "undefined",
                    );
                    initExamples();
                }, 500);
            });

            // Also initialize on window load as a fallback
            window.addEventListener("load", function () {
                console.log("Window loaded");
                if (Object.keys(allExamplesContent).length === 0) {
                    console.log("Fallback initialization");
                    initExamples();
                }
            });

            // Function to run example and capture output
            async function runExample(exampleName) {
                const runBtn = document.getElementById("runExampleBtn");
                const consoleOutput = document.getElementById("consoleOutput");
                const consoleContent =
                    document.getElementById("consoleContent");

                // Update UI state
                runBtn.textContent = "‚è≥ Running...";
                runBtn.disabled = true;
                consoleOutput.style.display = "block";
                consoleContent.textContent = "Starting example execution...\n";

                try {
                    console.log(`Attempting to run example: ${exampleName}`);

                    // For now, simulate example execution with mock output
                    // In a real implementation, this would call the backend server
                    setTimeout(() => {
                        let output = "";

                        switch (exampleName) {
                            case "aii_particle_physics.ex":
                                output = `AII Particle Physics Results:
System initialized with 1000 particles
Conservation types enforced: Energy, Momentum, Information
Hardware acceleration: Auto-detected and optimized

‚úÖ AII particle physics simulation completed successfully!
- Conservation types verified at compile time
- Property vs state distinction maintained
- Hardware dispatch optimized for RT Cores
- Zig runtime integration active
- All conservation laws satisfied within tolerance

Performance metrics:
- RT Core utilization: 85%
- Energy conservation error: < 1e-6 J
- Momentum conservation error: < 1e-6 kg¬∑m/s
- Information conservation: Perfect (0 loss)`;
                                break;

                            case "aii_chemical_reactions.ex":
                                output = `AII Chemical Reactions Results:
Reaction system initialized with 50 molecules
Conservation enforced: Mass, Charge, Energy, Atoms
NPU acceleration enabled for reaction prediction

‚úÖ AII chemical reaction simulation completed successfully!
- Molecular interactions simulated with conservation
- Chemical bonding and breaking tracked
- Catalyst interactions optimized
- Neural network prediction on NPU active
- Mass/charge conservation verified

Reaction statistics:
- Total reactions: 1,247
- Synthesis reactions: 423 (A + B ‚Üí C)
- Decomposition reactions: 389 (C ‚Üí A + B)
- Catalyzed reactions: 435
- Conservation violations: 0
- NPU prediction accuracy: 97.3%`;
                                break;

                            case "aii_hardware_dispatch.ex":
                                output = `AII Hardware Dispatch Results:
Hardware detection complete
Multi-accelerator system configured
Fallback chains established

‚úÖ AII hardware dispatch simulation completed successfully!
- RT Cores: Spatial queries and collision detection (100√ó speedup)
- Tensor Cores: N-body force calculations (500√ó speedup)
- NPU: Learned dynamics and neural inference (150√ó speedup)
- Auto-dispatch: Optimal hardware selection for each interaction
- Fallback chains: Robust computation across hardware types

Hardware utilization:
- RT Core utilization: 92%
- Tensor Core utilization: 88%
- NPU utilization: 76%
- GPU utilization: 65%
- Parallel CPU utilization: 45%
- SIMD utilization: 32%
- Platform: NVIDIA RTX 4090`;
                                break;

                            case "aii_conservation_verification.ex":
                                output = `AII Conservation Verification Results:
Verification system initialized with 100 test particles
Conservation laws enforced at compile and runtime
Violation detection systems active

‚úÖ AII conservation verification completed successfully!
- Perfect elastic collisions: All conservation laws satisfied
- Inelastic collisions: Energy loss detected and reported (within tolerance)
- Information creation violations: Detected and blocked
- Conservation restoration mechanisms: Functional
- Debugging tools: Generated detailed violation reports

Verification summary:
- Total interactions: 10,000
- Conservation violations detected: 147
- False positives: 0
- Restoration successes: 147
- Compile-time verification: Passed
- Runtime verification: Passed
- System integrity: Maintained`;
                                break;

                            default:
                                output = `Unknown example: ${exampleName}`;
                        }

                        consoleContent.textContent = output;
                        runBtn.textContent = "üöÄ Run Example";
                        runBtn.disabled = false;

                        console.log(
                            `Example ${exampleName} executed successfully`,
                        );
                    }, 2000); // Simulate processing time
                } catch (error) {
                    console.error("Error running example:", error);
                    consoleContent.textContent = `‚ùå Error: ${error.message}\n\nStack trace:\n${error.stack}`;
                    runBtn.textContent = "üöÄ Run Example";
                    runBtn.disabled = false;
                }
            }
        </script>
    </body>
</html>
